import type { FastifyInstance } from 'fastify';import { svc } from '../utils/supabase';export default async function r(app:FastifyInstance){app.post('/tenants/bootstrap',{ preHandler:[(req,reply)=>app.kafRequireAuth(req,reply)]},async (req, reply)=>{const a=(req as any).auth; if((a.memberships||[]).length>0) return reply.send({skipped:true}); const name=(req.body as any)?.restaurant_name||'My Restaurant'; const code=name.replace(/[^a-zA-Z]/g,'').slice(0,4).toUpperCase().padEnd(4,'X'); const { data:t } = await svc.from('tenants').insert([{ name, code }]).select('id, code').single(); await svc.from('staff').insert([{ tenant_id:t.id, user_id:a.userId, role:'admin' }]); return reply.send({ created:true, tenant_id:t.id, code:t.code });});}